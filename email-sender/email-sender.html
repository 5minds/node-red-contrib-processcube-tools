<script type="text/javascript">
    RED.nodes.registerType('email-sender', {
        category: 'ProcessCube Tools',
        color: '#02AFD6',
        defaults: {
            name: { value: "" },
            // Mail fields
            sender: { value: "Stoelting Ticket-System", required: true, validate: RED.validators.typedInput("senderType") },
            senderType: { value: "str" },
            address: { value: "", required: true, validate: RED.validators.typedInput("addressType") },
            addressType: { value: "str" },
            to: { value: "", required: true, validate: RED.validators.typedInput("toType") },
            toType: { value: "str" },
            cc: { value: "", validate: RED.validators.typedInput("ccType") },
            ccType: { value: "str" },
            bcc: { value: "", validate: RED.validators.typedInput("bccType") },
            bccType: { value: "str" },
            subject: { value: "", required: true, validate: RED.validators.typedInput("subjectType") },
            subjectType: { value: "str" },
            attachments: { value: "" },
            attachmentsType: { value: "msg" },
            htmlContent: { value: "", required: true, validate: RED.validators.typedInput("htmlContentType") },
            htmlContentType: { value: "str" },

            // SMTP-Fields
            host: { value: "", required: true, validate: RED.validators.typedInput("hostType") },
            hostType: { value: "str" },
            port: { value: "", required: true, validate: RED.validators.typedInput("portType") },
            portType: { value: "num" },
            user: { value: "", required: true, validate: RED.validators.typedInput("userType") },
            userType: { value: "str" },
            password: { value: "", required: true, type: "password" },
            passwordType: { value: "env", required: true },
            secure: { value: "", required: true, validate: RED.validators.typedInput("secureType") },
            secureType: { value: "bool" },
            rejectUnauthorized: { value: "", required: true, validate: RED.validators.typedInput("rejectUnauthorizedType") },
            rejectUnauthorizedType: { value: "bool" }
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-paper-plane",
        label: function() {
            return this.name || "Email Sender";
        },
        oneditprepare: function() {
            // Mail Fields
            $('#node-input-sender').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-senderType'
            });
            $('#node-input-address').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-addressType'
            });
            $('#node-input-to').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-toType'
            });
            $('#node-input-cc').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-ccType'
            });
            $('#node-input-bcc').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-bccType'
            });
            $('#node-input-subject').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-subjectType'
            });
            $('#node-input-attachments').typedInput({
                default: 'msg',
                types: ['msg', 'flow', 'global'],
                typeField: '#node-input-attachmentsType'
            });
            $('#node-input-htmlContent').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'json'],
                typeField: '#node-input-htmlContentType'
            });

            // SMTP Fields
            $('#node-input-host').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-hostType'
            });
            $('#node-input-port').typedInput({
                default: 'num',
                types: ['num', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-portType'
            });
            $('#node-input-user').typedInput({
                default: 'str',
                types: ['str', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-userType'
            });
            $('#node-input-password').typedInput({
                default: 'env',
                types: ['msg', 'flow', 'global', 'env'],
                typeField: '#node-input-passwordType'
            });
            $('#node-input-secure').typedInput({
                default: 'bool',
                types: ['bool', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-secureType'
            });
            $('#node-input-rejectUnauthorized').typedInput({
                default: 'bool',
                types: ['bool', 'msg', 'flow', 'global', 'env'],
                typeField: '#node-input-rejectUnauthorizedType'
            });
        }
    });
</script>

<script type="text/html" data-template-name="email-sender">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <h3>Mail Configuration</h3>
    <div class="form-row">
        <label for="node-input-sender"><i class="fa fa-user"></i> Sender</label>
        <input type="text" id="node-input-sender" placeholder="John Doe">
        <input type="hidden" id="node-input-senderType">
    </div>
    <div class="form-row">
        <label for="node-input-address"><i class="fa fa-envelope"></i> Address</label>
        <input type="text" id="node-input-address" placeholder="john.doe@example.com">
        <input type="hidden" id="node-input-addressType">
    </div>
    <div class="form-row">
        <label for="node-input-to"><i class="fa fa-user"></i> To</label>
        <input type="text" id="node-input-to" placeholder="my.test@example.com">
        <input type="hidden" id="node-input-toType">
    </div>
    <div class="form-row">
        <label for="node-input-cc"><i class="fa fa-user-plus"></i> CC</label>
        <input type="text" id="node-input-cc">
        <input type="hidden" id="node-input-ccType">
    </div>
    <div class="form-row">
        <label for="node-input-bcc"><i class="fa fa-user-secret"></i> BCC</label>
        <input type="text" id="node-input-bcc">
        <input type="hidden" id="node-input-bccType">
    </div>
    <div class="form-row">
        <label for="node-input-subject"><i class="fa fa-info-circle"></i> Subject</label>
        <input type="text" id="node-input-subject">
        <input type="hidden" id="node-input-subjectType">
    </div>
    <div class="form-row">
        <label for="node-input-attachments"><i class="fa fa-paperclip"></i> Attachments</label>
        <input type="text" id="node-input-attachments">
        <input type="hidden" id="node-input-attachmentsType">
    </div>
    <div class="form-row">
        <label for="node-input-htmlContent"><i class="fa fa-file-code-o"></i> HTML Content</label>
        <input type="text" id="node-input-htmlContent">
        <input type="hidden" id="node-input-htmlContentType">
    </div>

    <h3>SMTP Configuration</h3>
    <div class="form-row">
        <label for="node-input-host"><i class="fa fa-server"></i> Host</label>
        <input type="text" id="node-input-host" placeholder="smtp.gmail.com">
        <input type="hidden" id="node-input-hostType">
    </div>
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-plug"></i> Port</label>
        <input type="text" id="node-input-port" placeholder="587">
        <input type="hidden" id="node-input-portType">
    </div>
    <div class="form-row">
        <label for="node-input-user"><i class="fa fa-user"></i> User</label>
        <input type="text" id="node-input-user" placeholder="test.user@config.com">
        <input type="hidden" id="node-input-userType">
    </div>
    <div class="form-row">
        <label for="node-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-input-password">
        <input type="hidden" id="node-input-passwordType">
    </div>
    <div class="form-row">
        <label for="node-input-secure"><i class="fa fa-shield"></i> SSL/TLS (Secure)</label>
        <input type="text" id="node-input-secure">
        <input type="hidden" id="node-input-secureType">
    </div>
    <div class="form-row">
        <label for="node-input-rejectUnauthorized"><i class="fa fa-ban"></i> Reject Unauthorized</label>
        <input type="text" id="node-input-rejectUnauthorized">
        <input type="hidden" id="node-input-rejectUnauthorizedType">
    </div>
</script>

<script type="text/html" data-help-name="email-sender">
    <p>A custom node to send emails using an SMTP server. The configuration for each field can be sourced from a fixed value, or from a <code>msg</code>, <code>flow</code>, <code>global</code>, or <code>env</code> variable.</p>

    <h3>Configuration</h3>
    <p>Every field on the configuration panel is a <b>typed input</b>. Use the dropdown menu next to each field to select the source of its value. Note that <b>Sender</b>, <b>Address</b>, <b>To</b>, <b>Subject</b>, and <b>HTML Content</b> are required fields and must be configured before the node can be deployed.</p>

    <h4>Mail Configuration</h4>
    <dl class="message-properties">
        <dt>Sender <span class="property-type">string | variable</span></dt>
        <dd>The name of the sender, as displayed to the recipient.</dd>

        <dt>Address <span class="property-type">string | variable</span></dt>
        <dd>The sender's email address.</dd>

        <dt>To <span class="property-type">string | variable</span></dt>
        <dd>The primary recipient's email address. Separate multiple addresses with a comma.</dd>

        <dt>CC <span class="property-type">string | variable</span></dt>
        <dd>Addresses to be carbon-copied on the email.</dd>

        <dt>BCC <span class="property-type">string | variable</span></dt>
        <dd>Addresses to be blind-carbon-copied on the email.</dd>

        <dt>Subject <span class="property-type">string | variable</span></dt>
        <dd>The subject line of the email.</dd>

        <dt>Attachments <span class="property-type">array | variable</span></dt>
        <dd>A list of file attachments. This should be a variable containing an array of attachment objects.</dd>

        <dt>HTML Content <span class="property-type">string | variable</span></dt>
        <dd>The HTML body of the email.</dd>
    </dl>

    <h4>SMTP Configuration</h4>
    <dl class="message-properties">
        <dt>Host <span class="property-type">string | variable</span></dt>
        <dd>The hostname or IP address of the SMTP server.</dd>

        <dt>Port <span class="property-type">number | variable</span></dt>
        <dd>The port number of the SMTP server.</dd>

        <dt>User <span class="property-type">string | variable</span></dt>
        <dd>The username for SMTP authentication.</dd>

        <dt>Password <span class="property-type">string | variable</span></dt>
        <dd>The password for SMTP authentication.</dd>

        <dt>SSL/TLS (Secure) <span class="property-type">boolean | variable</span></dt>
        <dd>Use a secure connection. Set to <code>true</code> for SSL/TLS, <code>false</code> for a non-secure connection.</dd>

        <dt>Reject Unauthorized <span class="property-type">boolean | variable</span></dt>
        <dd>If <code>true</code>, the server's certificate is rejected if it's not authorized by a trusted CA.</dd>
    </dl>
</script>
